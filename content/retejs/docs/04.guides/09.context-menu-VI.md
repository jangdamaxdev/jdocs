---
description: Tìm hiểu cách cài đặt rete-context-menu-plugin trong node editor của bạn. Với plugin này, người dùng có thể thêm node vào editor thông qua menu chuột phải, giúp việc tạo và quản lý workflow của ứng dụng dễ dàng hơn
keywords: context menu,menu
---

# Context menu

::alert
Hướng dẫn này dựa trên [Basic](/docs/guides/basic). Bạn nên xem qua để hiểu tổng thể trước khi đọc hướng dẫn này.
::
::references
:ref-example{title="Context menu" link="/examples/context-menu"}
:ref-github{title="Plugin" link="https://github.com/retejs/context-menu-plugin"}
::

## Cài đặt dependencies {#install-dependencies}

:kit

```bash
npm i rete-context-menu-plugin
```

## Chuẩn bị node {#prepare-nodes}

Để thuận tiện và tái sử dụng code, nên tạo các class riêng cho từng node:

```ts
class NodeA extends ClassicPreset.Node {
  constructor(socket: ClassicPreset.Socket) {
    super("NodeA");

    this.addControl("port", new ClassicPreset.InputControl("text", {}));
    this.addOutput("port", new ClassicPreset.Output(socket));
  }
}

/// class NodeB extends ...

type Node = NodeA | NodeB;
type Schemes = GetSchemes<Node, Connection<Node, Node>>;
```

## Kết nối plugin {#connect-plugin}

Để đơn giản, dùng preset classic và chỉ định danh sách các item kèm hàm trả về node cần thiết

```ts
import {
  ContextMenuExtra,
  ContextMenuPlugin,
  Presets as ContextMenuPresets,
} from "rete-context-menu-plugin";

type AreaExtra = ReactArea2D<Schemes> | ContextMenuExtra;

const contextMenu = new ContextMenuPlugin<Schemes>({
  items: ContextMenuPresets.classic.setup([
    ["NodeA", () => new NodeA(socket)],
    ["NodeB", () => new NodeB(socket)],
  ]),
});

area.use(contextMenu);
```

Tuy nhiên, như vậy là chưa đủ vì plugin render chịu trách nhiệm hiển thị giao diện

## Hiển thị context menu {#render-context-menu}

Hiện tại, việc hiển thị context menu có thể thực hiện bằng các plugin render cho **React.js**, **Vue.js**, **Angular**, **Svelte** và **Lit**.

```ts
import { Presets } from "rete-react-plugin"; // hoặc  rete-vue-plugin, rete-angular-plugin, rete-svelte-plugin, @retejs/lit-plugin

render.addPreset(Presets.contextMenu.setup());
```

Để biết cách kết nối plugin render cụ thể với stack của bạn, hãy làm theo hướng dẫn cho
[React.js](/docs/guides/renderers/react), [Vue.js](/docs/guides/renderers/vue), [Angular](/docs/guides/renderers/angular), [Svelte](/docs/guides/renderers/svelte) hoặc [Lit](/docs/guides/renderers/lit)

Click vào vùng trống sẽ mở menu hiển thị các node có thể tạo, hoặc click vào node hiện có để xóa nó.

## Subitems {#subitems}

Để chỉ định item node là subitem, bạn có thể dùng mảng thay vì hàm tạo node:

```ts
const contextMenu = new ContextMenuPlugin<Schemes>({
  items: ContextMenuPresets.classic.setup([
    ["Math", [["Number", () => new NumberNode()]]],
  ]),
});
```

## Tùy chọn tích hợp sẵn cho node và connection {#built-in-options}

Tất cả node và connection đều có tùy chọn `Delete` trong menu chuột phải. Tùy chọn này cho phép xóa node (đồng thời xóa connection liên quan) hoặc xóa từng connection.

Một tùy chọn khác không xuất hiện mặc định trên node là `Clone`. Nó sẽ xuất hiện với node có phương thức `clone`. Ví dụ:

```ts
class NodeA extends ClassicPreset.Node {
  clone() {
    return new NodeA();
  }
}
```

## Custom preset {#custom-preset}

Preset classic cho phép bạn chỉ định nhanh các item cho menu chính và menu riêng cho node, nhưng có thể chưa đủ linh hoạt. Khi đó, bạn có thể tự định nghĩa menu:

```ts
const contextMenu = new ContextMenuPlugin<Schemes>({
  items(context, plugin) {
    if (context === "root") {
      return {
        searchBar: false,
        list: [
          { label: "Custom", key: "1", handler: () => console.log("Custom") },
          {
            label: "Collection",
            key: "1",
            handler: () => null,
            subitems: [
              {
                label: "Subitem",
                key: "1",
                handler: () => console.log("Subitem"),
              },
            ],
          },
        ],
      };
    }
    return {
      searchBar: false,
      list: [],
    };
  },
});
```

Trong đó, `context` có thể là `'root'`, instance node hoặc instance connection

## Mở menu bằng code #{trigger-context-menu}

Để mở menu chuột phải bằng code, bạn cần tạo một `PointerEvent` với tọa độ mong muốn và gọi phương thức `area.emit()`:

```ts
const event = new PointerEvent("contextmenu", {
  clientX: x,
  clientY: y,
});

await area.emit({ type: "contextmenu", data: { event, context } });
```

Trong đó

- `x`, `y` là giá trị số (ví dụ, tọa độ con trỏ, bạn cần lấy riêng),
- `context` có thể là `'root'` hoặc instance node, connection, hoặc phần tử khác trong editor.

Xem kết quả hoàn chỉnh tại ví dụ [Context menu](/examples/context-menu).
