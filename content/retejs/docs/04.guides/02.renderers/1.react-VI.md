---
description: Tìm hiểu cách sử dụng component React.js và tạo component tùy chỉnh với rete-react-plugin. Hướng dẫn này cung cấp các bước chi tiết để sử dụng plugin, kèm tham khảo và ví dụ hữu ích để bạn bắt đầu
keywords: react.js,react,rendering
---

# React.js

::alert
Hướng dẫn này là phần mở rộng của [Basic](/docs/guides/basic) và cung cấp hướng dẫn chuyên sâu về cách sử dụng `rete-react-plugin`
::

::references
:ref-example{title="Basic" link="/examples/basic/react"}
:ref-example{title="Controls" link="/examples/controls/react"}
:ref-example{title="Customization" link="/examples/customization/react"}
:ref-github{title="Plugin" link="https://github.com/retejs/react-plugin"}
:ref-external{title="React.js" link="https://react.dev/"}
:ref-guide{title="Context menu" link="/docs/guides/context-menu"}
:ref-guide{title="Minimap" link="/docs/guides/minimap"}
:ref-guide{title="Reroute" link="/docs/guides/reroute"}
::

Plugin này sử dụng preset classic bao gồm các thành phần giao diện cho node, connection, socket và input control. Nó sử dụng `styled-components` để thiết kế các thành phần này.

Plugin này có thể dùng trong bất kỳ ứng dụng nào, bất kể stack của bạn (**React.js**, **Vue.js**, **Angular**, v.v.).

## Cài đặt dependencies {#install-dependencies}

:kit

```bash
npm i rete-react-plugin rete-render-utils styled-components
```

Nếu bạn sử dụng plugin này trong ứng dụng không dùng **React.js**, hãy đảm bảo cài thêm các dependency **React.js** cần thiết.

```bash
npm i react@18 react-dom@18
```

## Kết nối plugin {#connect-plugin}

```ts
import { createRoot } from "react-dom/client";
import { AreaPlugin } from "rete-area-plugin";
import { ReactPlugin, Presets, ReactArea2D } from "rete-react-plugin";

type AreaExtra = ReactArea2D<Schemes>;

// ....

const render = new ReactPlugin<Schemes, AreaExtra>({ createRoot });

render.addPreset(Presets.classic.setup());

area.use(render);
```

Xem trang [Basic](/examples/basic/react) để biết ví dụ sử dụng plugin render này.

## Sử dụng React.js 16 {#using-react-16}

Nếu bạn dùng React.js phiên bản 16 (hoặc 17), chỉ cần bỏ phương thức `createRoot`

```ts
const render = new ReactPlugin<Schemes, AreaExtra>();
```

## Hook "useRete" {#use-rete-hook}

Khi làm việc với ứng dụng React, hook `useRete` giúp loại bỏ code lặp để bind editor vào phần tử HTML. Điều này đặc biệt quan trọng với các cập nhật động, khi instance cũ của editor cần bị loại bỏ và thay thế bằng instance mới.

```tsx
import { useRete } from "rete-react-plugin";

function App() {
  const [ref, editor] = useRete(createEditor);

  return <div ref={ref} className="rete"></div>;
}
```

Trong đó, `createEditor` nên trả về object có phương thức `destroy` (thường gọi `area.destroy()`).

## Controls {#controls}

Plugin này cung cấp các control dựng sẵn, hiển thị dựa trên các object sau:

- `ClassicPreset.InputControl` dưới dạng `<input type="number" />` hoặc `<input type="text" />`

Chỉ cần thêm control vào node

```ts
node.addControl(
  "my-control",
  new ClassicPreset.InputControl("number", {
    initial: 0,
    readonly: false,
    change(value) {},
  })
);
```

Nếu muốn thêm các loại control khác, bạn có thể trả về functional component cần thiết trong handler `control` của thuộc tính `customize`.

```tsx
render.addPreset(
  Presets.classic.setup({
    customize: {
      control(context) {
        if (context.payload.isButton) {
          return (props: {
            data: { isButton: true; label: string; onClick: () => void };
          }) => (
            <button
              onPointerDown={(e) => e.stopPropagation()}
              onClick={props.data.onClick}
            >
              {props.data.label}
            </button>
          );
        }
        if (context.payload instanceof ClassicPreset.InputControl) {
          // đừng quên chỉ rõ Presets.classic.Control
          return Presets.classic.Control;
        }
      },
    },
  })
);

node.addControl("my-button", { isButton: true, label: "Click", onClick() {} });
```

Đây là phiên bản đơn giản phù hợp cho mục đích giới thiệu. Khi làm dự án, nên theo cách trong [ví dụ](/examples/controls/react).

Hãy gọi `stopPropagation` trong `onPointerDown` để tránh area bắt sự kiện như `click`. Nếu gặp vấn đề này ở React 16 hoặc phần tử tương tác được thêm vào custom node thay vì control, thử giải pháp sau:

```tsx
import { Drag } from "rete-react-plugin";

<Drag.NoDrag>
  <button>{props.data.label}</button>
</Drag.NoDrag>;
```

Hoặc dùng hook để tránh lồng thừa

```tsx
const ref = React.useRef(null)

Drag.useNoDrag(ref)

<button ref={ref}>
  {props.data.label}
</button>
```

## Tùy biến {#customization}

Tương tự như cách trên, bạn có thể thay thế component node, connection hoặc socket.

### Node styles {#node-styles}

Cách đơn giản nhất là mở rộng component hiện tại và dùng `styled-components` để thêm style.

```tsx
import { Presets } from "rete-react-plugin";
import { css } from "styled-components";

const myStyles = css<{ selected?: boolean }>`
  background: white;
  ${(props) =>
    props.selected &&
    css`
      border-color: red;
    `}
`;

function StyledNode(props: { data: Schemes["Node"] }) {
  return <Presets.classic.Node styles={() => myStyles} {...props} />;
}

render.addPreset(
  Presets.classic.setup({
    customize: {
      node() {
        return StyledNode;
      },
    },
  })
);
```

Áp dụng cách này sẽ khiến tất cả node dùng `myStyles`.

### Node cụ thể {#render-specific-node}

Bạn có thể thêm điều kiện để chỉ áp dụng style cho node cụ thể.

```ts
render.addPreset(
  Presets.classic.setup({
    customize: {
      node(context) {
        if (context.payload.label === "White") {
          return StyledNode;
        }
        return Presets.classic.Node;
      },
    },
  })
);

await editor.addNode(new ClassicPreset.Node("White"));
```

### Tùy biến toàn bộ node {#full-node-customization}

Nếu muốn thay đổi hoàn toàn cấu trúc node, bạn có thể tự viết component giống như [Node.tsx](https://github.com/retejs/react-plugin/blob/next/src/presets/classic/components/Node.tsx) trong preset classic.

```ts
import { CustomNode } from "./CustomNode";

render.addPreset(
  Presets.classic.setup({
    customize: {
      node() {
        return CustomNode;
      },
    },
  })
);
```

Cách triển khai `CustomNode` có trong file **CustomNode.tsx** của ví dụ [Customization for React.js](/examples/customization/react).

### Tùy biến toàn bộ connection {#full-connection-customization}

Dùng **Connection.tsx** làm điểm bắt đầu từ thư mục [presets/classic/components](https://github.com/retejs/react-plugin/blob/next/src/presets/classic/components) của mã nguồn plugin.

```ts
import { CustomConnection } from "./CustomConnection";

render.addPreset(
  Presets.classic.setup({
    customize: {
      connection() {
        return CustomConnection;
      },
    },
  })
);
```

### Tùy biến toàn bộ socket {#full-socket-customization}

Dùng **Socket.tsx** làm điểm bắt đầu từ thư mục [presets/classic/components](https://github.com/retejs/react-plugin/blob/next/src/presets/classic/components) của mã nguồn plugin.

```ts
import { CustomSocket } from "./CustomSocket";

render.addPreset(
  Presets.classic.setup({
    customize: {
      socket() {
        return CustomSocket;
      },
    },
  })
);
```

## Tùy biến context menu {#customize-context-menu}

Vì các component context menu sử dụng `styled-components`, bạn có thể tùy biến style như sau:

```ts
import styled from "styled-components";

const { Menu, Common, Search, Item, Subitems } = Presets.contextMenu;

const CustomMenu = styled(Menu)`
  width: 320px;
`;
const CustomItem = styled(Item)`
  background: grey;
`;

render.addPreset(
  Presets.contextMenu.setup({
    customize: {
      main: () => CustomMenu,
      item: () => CustomItem,
      common: () => Common,
      search: () => Search,
      subitems: () => Subitems,
    },
  })
);
```

## Các preset khác {#other presets}

- [context menu](/docs/guides/context-menu)
- [minimap](/docs/guides/minimap)
- [reroute](/docs/guides/reroute)

Xem kết quả hoàn chỉnh tại ví dụ [Customization for React.js](/examples/customization/react).
