---
description: Tìm hiểu cách triển khai chức năng undo/redo trong node editor với rete-history-plugin, và cải thiện trải nghiệm người dùng
keywords: undo,redo,history,rete-history-plugin,ux,user experience
---

# Undo/Redo

::alert
Hướng dẫn này dựa trên [Basic](/docs/guides/basic). Bạn nên xem qua để hiểu tổng thể trước khi đọc hướng dẫn này.
::
::references
:ref-example{title="History" link="/examples/history"}
:ref-github{title="Plugin" link="https://github.com/retejs/history-plugin"}
::

## Cài đặt dependencies {#install-dependencies}

:kit

```bash
npm i rete-history-plugin
```

## Kết nối plugin {#connect-plugin}

```ts
import { HistoryPlugin, HistoryActions } from "rete-history-plugin";

const history = new HistoryPlugin<Schemes, HistoryActions<Schemes>>();

area.use(history);
```

## Classic preset {#classic-preset}

Tương tự hầu hết các plugin, nó dựa vào preset để kích hoạt đầy đủ chức năng.

```ts
import { Presets } from "rete-history-plugin";

history.addPreset(Presets.classic.setup());
```

Plugin này chịu trách nhiệm theo dõi lịch sử thêm, xóa, di chuyển node, cũng như thêm và xóa connection.

## Sử dụng {#usage}

Plugin không tự động theo dõi thao tác người dùng như phím tắt. Để cho phép người dùng thao tác, bạn có thể tự gọi các phương thức `undo`/`redo`

```ts
await history.undo();
await history.redo();
```

Hoặc dùng extension mặc định theo dõi phím tắt `Ctrl+Z`/`Ctrl+Y`

```ts
import { HistoryExtensions } from "rete-history-plugin";

HistoryExtensions.keyboard(history);
```

## Quản lý lịch sử {#history-management}

Nếu bạn cần chức năng bổ sung ngoài việc theo dõi node và connection, bạn có thể tạo action tùy chỉnh và thêm vào lịch sử

```ts
class MyAction implements HistoryAction {
  undo(): void | Promise<void> {
    // hành động undo
  }
  redo(): void | Promise<void> {
    // hành động redo
  }
}

const history = new HistoryPlugin<
  Schemes,
  HistoryActions<Schemes> | MyAction
>();

const myAction = new MyAction();

history.add(myAction);
```

Để lấy danh sách lịch sử, dùng phương thức `getHistorySnapshot` hoặc `getRecent` (lưu ý không thể sửa trực tiếp lịch sử)

```ts
const list = history.getHistorySnapshot();
const recentFor1s = history.getRecent(1000);
```

Dùng phương thức mới nhất sẽ trả về danh sách các action trong vòng 1 giây vừa qua. Vì các action này phụ thuộc vào thời gian, plugin có thể nhóm chúng lại, giúp người dùng không phải nhấn 'Ctrl + Z' nhiều lần khi có nhiều thao tác liên tiếp trong thời gian ngắn. Điều này đặc biệt hữu ích khi người dùng xóa một node, kéo theo việc xóa tự động các connection liên quan.

Ngoài ra, bạn có thể cấu hình thời gian như sau, trong đó `200` là ngưỡng thời gian mặc định tính bằng mili giây. Nếu khoảng thời gian giữa các action liền kề ngắn hơn giá trị này, plugin sẽ coi chúng là cùng một nhóm.

```ts
const history = new HistoryPlugin<Schemes>({ timing: 200 });
```

Để quá trình undo hoặc redo không phụ thuộc vào thời gian giữa các action, bạn có thể dùng cách sau:

```ts
// action 1
// action 2
history.separate(); // hoặc myAction.separated = true
// action 3
```

Như vậy, khi gọi lệnh `undo` lần đầu, nó chỉ undo action thứ ba, dù thời gian giữa action này và action trước đó nhỏ hơn 200 mili giây.

Xem kết quả hoàn chỉnh tại ví dụ [History](/examples/history).
