---
description: Tìm hiểu cách tạo các connection có thể chọn được với hướng dẫn chi tiết này. Làm theo từng bước và đoạn code để sửa đổi kiểu connection, thêm trường 'selected' tùy chọn và chọn connection bằng code
keywords: select connection,selectable,connection,custom connection
---

# Selectable connections

::alert
Hướng dẫn này dựa trên [Basic](/docs/guides/basic). Bạn nên xem qua để hiểu tổng thể trước khi đọc hướng dẫn này.
::
::references
:ref-example{title="Selectable connections" link="/examples/selectable-connections"}
:ref-guide{title="Selectable" link="/docs/guides/selectable"}
::

## Chuẩn bị kiểu dữ liệu

Thêm trường tùy chọn `selected` vào kiểu connection cho phép chúng ta đánh dấu connection được chọn bằng code

```ts
class Connection extends ClassicPreset.Connection<
  ClassicPreset.Node,
  ClassicPreset.Node
> {
  selected?: boolean;
}

type Schemes = GetSchemes<ClassicPreset.Node, Connection>;
```

## Custom connection

Bước đầu tiên là triển khai một connection tùy chỉnh có thể click và đổi màu khi được chọn.

Chúng ta sẽ bắt đầu với component [Connection.tsx](https://github.com/retejs/react-plugin/blob/next/src/presets/classic/components/Connection.tsx) từ preset classic và mở rộng chức năng bằng cách thêm các tính năng mới.

Có thể làm connection thân thiện hơn bằng cách định nghĩa một path trong suốt để dễ click.

```ts
import styled from "styled-components";

const HoverPath = styled.path`
  fill: none;
  stroke-width: 15px;
  pointer-events: auto;
  stroke: transparent;
`;
```

Nâng cấp component `Path` bằng cách thêm prop `selected` và thay đổi màu stroke.

```ts
const Path = styled.path<{ selected?: boolean >`
  stroke: ${(props) => (props.selected ? "rgb(255, 217, 44)" : "steelblue")};
`;

```

Component sẽ trả về template sau:

```tsx
<Svg
  onPointerDown={(e: PointerEvent) => e.stopPropagation()}
  onClick={props.click}
>
  <HoverPath d={path} />
  <Path selected={props.data.selected} d={path} />
</Svg>
```

Connection hiện tại có thể được đánh dấu như sau:

```ts
connection.selected = true;
area.update("connection", connection.id);
```

## Đồng bộ connection được chọn

Chuẩn bị selector

```ts
const selector = AreaExtensions.selector();
const accumulating = AreaExtensions.accumulateOnCtrl();

AreaExtensions.selectableNodes(area, selector, { accumulating });
```

Thêm connection vào selector có thể thực hiện như sau (ví dụ khi click vào connection):

```ts
selector.add(
  {
    id: connection.id,
    label: "connection",
    translate() {},
    unselect() {
      connection.selected = false;
      area.update("connection", connection.id);
    },
  },
  accumulating.active()
);

connection.selected = true;
area.update("connection", connection.id);
```

Bây giờ, chúng ta sẽ tổng hợp tất cả vào một component duy nhất dùng closure đơn giản (các phương pháp khác nên dùng cho production), và truyền nó làm component connection tùy chỉnh

```tsx
function SelectableConnectionBind(props: { data: Schemes["Connection"] }) {
  return (
    <SelectableConnection
      {...props}
      click={() => {
        selector.add({
          /// ...
        });
        // đặt code thêm vào selector như trên tại đây
      }}
    />
  );
}

render.addPreset(
  Presets.classic.setup({
    customize: {
      connection() {
        return SelectableConnectionBind;
      },
    },
  })
);
```

Xem kết quả hoàn chỉnh tại ví dụ [Selectable connections](/examples/selectable-connections).
