---
description: Tìm hiểu cách validate node và connection trong node editor với hệ thống plugin linh hoạt của Rete.js, đảm bảo tính toàn vẹn cho node và connection với hướng dẫn chi tiết này
keywords: validate,node validation,connection validation
---

# Validation

::references
:ref-example{title="Chatbot" link="/examples/chatbot"}
::

Framework cung cấp hệ thống plugin và message linh hoạt, cho phép bạn mở rộng chức năng của các thành phần và kiểm soát hành vi của chúng. Điều này có thể thực hiện bằng cách sử dụng pipe cho các loại message cụ thể.

## Validate node {#nodes-validation}

Việc validate sẽ được thực hiện khi thêm node, ví dụ ngăn không cho thêm node loại nhất định cho tới khi node bắt đầu đã được thêm

```ts
editor.addPipe((context) => {
  if (context.type === "nodecreate") {
    if (context.data instanceof EndNode) {
      const hasBeginNode = editor
        .getNodes()
        .some((n) => n instanceof BeginNode);

      if (!hasBeginNode) {
        alert("cannot add EndNode until BeginNode is added");
        return;
      }
    }
  }
  return context;
});
```

Trong đó, `EndNode` và `BeginNode` là các class mở rộng từ `ClassicPreset.Node`.

Trường hợp này sử dụng kỹ thuật ngăn truyền message bằng cách chỉ định `return` không giá trị. Kỹ thuật này phù hợp cho các loại như `nodecreate`, `noderemove`, `connectioncreate` và `connectionremove`.

## Validate connection {#connections-validation}

Nguyên tắc tương tự có thể dùng để ngăn truyền message loại `connectioncreate`.

```ts
editor.addPipe((context) => {
  if (context.type === "connectioncreate") {
    if (!canCreateConnection(editor, context.data)) {
      alert("Sockets are not compatible");
      return;
    }
  }
  return context;
});
```

Trong đó, `canCreateConnection` là bất kỳ hàm nào nhận instance connection `context.data` và trả về boolean.

Hãy lấy ví dụ [Chatbot](/examples/chatbot), đặc biệt là các module `chatbot/utils.ts` và `chatbot/sockets.ts`, và áp dụng cách tiếp cận này cho hàm `canCreateConnection`. Đầu tiên, triển khai socket nâng cao:

```ts
import { ClassicPreset } from "rete";

export class ActionSocket extends ClassicPreset.Socket {
  constructor() {
    super("Action");
  }

  isCompatibleWith(socket: ClassicPreset.Socket) {
    return socket instanceof ActionSocket;
  }
}

export class TextSocket extends ClassicPreset.Socket {
  constructor() {
    super("Text");
  }

  isCompatibleWith(socket: ClassicPreset.Socket) {
    return socket instanceof TextSocket;
  }
}
```

Bằng cách sử dụng phương thức `isCompatibleWith`, các loại socket có thể chỉ định loại socket nào tương thích.

Sau đó, triển khai hàm nhận connection làm đối số, trả về socket tương ứng từ node và kiểm tra tính tương thích.

```ts
export function canCreateConnection(
  editor: NodeEditor<Schemes>,
  connection: Schemes["Connection"]
) {
  const { source, target } = getConnectionSockets(editor, connection);

  return source && target && source.isCompatibleWith(target);
}
```

Trong đó, hàm `getConnectionSockets` được lấy từ ví dụ đã đề cập ở trên.
