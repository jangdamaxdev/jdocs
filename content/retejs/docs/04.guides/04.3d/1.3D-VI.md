---
description: Nâng cao cảnh 3D của bạn với node editor bằng hướng dẫn này. Tìm hiểu cách sử dụng rete-area-3d-plugin để tạo một scene sử dụng Three.js. Kết hợp render đối tượng 3D và các phần tử HTML gốc trong cùng một viewport để có tính tương tác đầy đủ
keywords: 3d,three.js,embed
---

# 3D

::alert
Hướng dẫn này dựa trên [Basic](/docs/guides/basic). Bạn nên xem qua để hiểu đầy đủ nội dung của hướng dẫn này.
::

::references
:ref-example{title="3D" link="/examples/3d"}
:ref-example{title="Multiple 3D editors" link="/examples/3d/multiple-3d"}
:ref-external{title="Three.js" link="https://threejs.org/"}
:ref-github{title="Plugin" link="https://github.com/retejs/area-3d-plugin"}
::

Hướng dẫn này trình bày cách tích hợp node editor vào một cảnh 3D. Điều này có thể thực hiện được nhờ `rete-area-3d-plugin`, thay thế cho `rete-area-plugin` tiêu chuẩn.

:diagram{name="guides/3d/index" caption="Kiến trúc"}

Dựa trên Three.js, plugin này tạo ra một scene chứa camera và hai renderer - `CSS3DRenderer` và `WebGLRenderer`. Nhờ đó, các đối tượng 3D và phần tử HTML gốc được render cùng nhau trong một viewport, cho phép chúng chồng lấp lên nhau. Lợi ích chính của việc sử dụng phần tử gốc (thay vì render ra texture) là giữ được tính tương tác đầy đủ.

## Cài đặt dependencies {#install-dependencies}

:kit

Trước khi sử dụng plugin này, bạn cần cài đặt riêng peer dependency `three`.

```bash
npm i rete-area-3d-plugin three @types/three
```

## Kết nối plugin {#connect-plugin}

Nếu bạn đã làm theo hướng dẫn cơ bản, bạn sẽ cần thay thế khởi tạo Area2DPlugin bằng Area3DPlugin và thay đổi một số định nghĩa kiểu.

```ts
import { Area3D, Area3DPlugin } from "rete-area-3d-plugin";

type AreaExtra = Area3D<Schemes>;

const area = new Area3DPlugin<Schemes, AreaExtra>(container);

editor.use(area);
```

Như vậy, container sẽ bao gồm cả phần tử `<canvas>` và một container cho các phần tử HTML được biến đổi 3D.

Nếu editor của bạn có node, bạn sẽ thấy chúng trong viewport, nhưng chúng sẽ không tương tác được. Để cung cấp phản hồi trực quan cho việc tương tác với node, nó cần là một phần của animation loop và được liên kết với `Object3D`, đối tượng chịu trách nhiệm kéo thả trực tiếp.

```ts
Area3DExtensions.animate(area);
```

Extension này sử dụng cách tiếp cận animation loop điển hình của **three.js**, sử dụng hàm `render()` cùng với `requestAnimationFrame()`.

Ngoài ra, chúng ta cần liên kết các node và connection với hình học trong cảnh 3D để cho phép tương tác và tránh chồng lấp không mong muốn với các đối tượng khác.

```ts
Area3DExtensions.forms.connection(render);
Area3DExtensions.forms.node(area);
```

Khi render, các extension này sẽ tạo ra hình học mô phỏng chính xác hình dạng của node và connection.

Bây giờ bạn có thể tương tác với các node và xoay hoặc di chuyển camera xung quanh chúng. Xem kết quả hoàn chỉnh tại trang ví dụ [3D](/examples/3d).

## Các extension bổ sung {#additional-extensions}

Một số extension có sẵn trong `rete-area-plugin` có thể được sử dụng chỉ trong editor, không phụ thuộc vào viewport hay các yếu tố tương tự.

```ts
import { AreaExtensions } from "rete-area-plugin";

AreaExtensions.showInputControl(area);
AreaExtensions.simpleNodesOrder(area);
AreaExtensions.snapGrid(area, { size: 30 });
AreaExtensions.selectableNodes(area, AreaExtensions.selector(), {
  accumulating: AreaExtensions.accumulateOnCtrl(),
});
```

Trong plugin này, các extension sau có sẵn:

```ts
import { Area3DExtensions } from "rete-area-3d-plugin";

Area3DExtensions.forms.comment(area); // tạo hình học cho plugin comment
Area3DExtensions.forms.reroute(area); // tạo hình học cho plugin reroute

Area3DExtensions.lookAt(area, editor.getNodes()); // thay thế cho zoomAt từ rete-area-plugin
```

## Quản lý scene {#scene-management}

:diagram{name="guides/3d/scene" caption="Scene"}

Như đã đề cập, plugin này tạo ra một scene hoàn chỉnh với camera và các renderer. Để truy cập chúng, bạn có thể sử dụng đoạn mã sau:

```ts
const { scene } = area.area;

scene.root; // Scene của three.js
scene.camera; // PerspectiveCamera
scene.renderer.css3d; // CSS3DRenderer
scene.renderer.webgl; // WebGLRenderer
scene.orbit; // OrbitControls
```

Ví dụ, bạn có thể tắt điều khiển quỹ đạo (`scene.orbit.enabled = false`) và thêm điều khiển khác, hoặc điều chỉnh các thiết lập của renderer hoặc camera.

Bạn có thể thêm đối tượng 3D bằng cách truy cập `scene.root`, đây là một instance của Scene trong Three.js.

## Phần tử HTML tuỳ chỉnh {#custom-html-elements}

Nếu bạn muốn thêm phần tử HTML vào scene, cụ thể là trong canvas của editor, hãy sử dụng đoạn mã sau:

```ts
area.area.content.add(element);
```

Một phần tử HTML sẽ được thêm vào canvas của editor tại vị trí gốc. Để đảm bảo nó không chồng lấp với các phần tử khác trong scene, nó nên có hình học phản ánh đúng hình dạng của nó.

```ts
area.area.content.updateGeometry(element, bufferGeometry);
```

Xem thêm ví dụ trong [mã nguồn](https://github.com/retejs/area-3d-plugin/tree/main/src/extensions/forms)

Đối với các phần tử HTML khác, nó sẽ duy trì thứ tự riêng, bạn có thể thay đổi như sau:

```ts
area.area.content.reorder(element, nextElement);
```

Xoá phần tử:

```ts
area.area.content.remove(element);
```

## Tuỳ chỉnh {#customization}

Trong trường hợp bạn đã tuỳ chỉnh node hoặc connection, bạn có thể nhận thấy chúng không khớp với placeholder trong scene 3D. Để điều chỉnh chúng theo hình dạng mới, bạn có thể tự triển khai hình học hoặc tái sử dụng hình học có sẵn với các tham số khác nhau.

Ví dụ thay đổi border radius của node:

```ts
Area3DExtensions.forms.node(area, {
  customize(node) {
    return Area3DExtensions.forms.createClassicNodeGeometry(node, {
      borderRadius: 0,
    });
  },
});
```

Ví dụ về hình học connection với độ dày lớn hơn:

```ts
Area3DExtensions.forms.connection(reactRender, {
  customize(path) {
    return Area3DExtensions.forms.createClassicConnectionGeometry(path, 10);
  },
});
```

## Multiple editors {#multiple-editors}

Ngoài ra, plugin còn hỗ trợ thêm nhiều editor vào cùng một scene. Bạn có thể thực hiện điều này bằng cách tạo một instance chính của `Area3DPlugin` và chia sẻ nó cho các editor khác.

```ts
const mainEditor = new NodeEditor<Schemes>();
const mainArea = new Area3DPlugin<Schemes, AreaExtra>(container);

mainEditor.use(mainArea);

const secondaryEditor = new NodeEditor<Schemes>();
const secondaryArea = mainArea.share();

secondaryEditor.use(secondaryArea);
```

Trong một scene nhất định, bạn sẽ thấy hai editor, được đặt trên cùng một mặt phẳng và chồng lên nhau. Để tách chúng ra, bạn có thể thay đổi vị trí và hướng của editor thứ hai.

```ts
const canvas = secondaryArea.area.getCanvas();

canvas.rotateY(Math.PI / 2);
canvas.get(sharedArea)?.translateX(500);
```

Xem kết quả hoàn chỉnh tại trang ví dụ [Multiple 3D editors](/examples/3d/multiple-3d).
