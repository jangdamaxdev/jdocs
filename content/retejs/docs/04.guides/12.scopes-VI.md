---
description: Tìm hiểu cách sử dụng rete-scopes-plugin để tạo subgraph trong node editor của bạn. Plugin này cho phép thiết lập quan hệ cha-con giữa các node, giúp nhóm các node trong nội dung node cha
keywords: scopes,parent-child,subgraph,nested graph
---

# Scopes

::alert
Hướng dẫn này dựa trên [Basic](/docs/guides/basic). Bạn nên xem qua để hiểu tổng thể trước khi đọc hướng dẫn này.
::
::references
:ref-example{title="Scopes" link="/examples/scopes"}
:ref-guide{title="Arrange nodes" link="/docs/guides/arrange"}
:ref-github{title="Plugin" link="https://github.com/retejs/scopes-plugin"}
::

Plugin `rete-scopes-plugin` cung cấp các tính năng để xây dựng node editor với các node lồng nhau, còn gọi là subgraph. Plugin này được phân loại là [advanced](/docs/licensing).

Cách tiếp cận này sử dụng node làm phần tử cha cho các node khác. Điều này cho phép khi di chuyển node cha thì toàn bộ node con cũng di chuyển theo, và khi di chuyển node con thì kích thước node cha sẽ được điều chỉnh. Việc lồng nhau có thể nhiều cấp.

## Cài đặt dependencies {#install-dependencies}

:kit

```bash
npm i rete-scopes-plugin
```

## Chuẩn bị node {#prepare-nodes}

Plugin yêu cầu kích thước node phải được chỉ định rõ ràng:

```ts
class Node extends ClassicPreset.Node {
  width = 190;
  height = 120;
  parent?: string;
}
class Connection<N extends Node> extends ClassicPreset.Connection<N, N> {}

type Schemes = GetSchemes<Node, Connection<Node>>;
```

Mục đích là để cho phép thay đổi kích thước node động nếu node có node con lồng bên trong.

Ngoài ra, nên chỉ định trường `parent` tùy chọn để gán node cha bằng code.

## Kết nối plugin {#connect-plugin}

```ts
import { ScopesPlugin, Presets as ScopesPresets } from "rete-scopes-plugin";

const scopes = new ScopesPlugin<Schemes>();

scopes.addPreset(ScopesPresets.classic.setup());

area.use(scopes);
```

Đoạn code này dựa vào preset classic cung cấp chức năng tương tác với scope của người dùng. Để chọn node và gán làm node cha, người dùng có thể nhấn giữ node và kéo lên node khác.

## Thêm node {#add-nodes}

Thêm một vài node, trong đó một node làm node cha:

```ts
const node1 = new Node("A");
const parent1 = new Node("Parent");

node1.parent = parent1.id; // chỉ định node1 là node con của parent1

await editor.addNode(parent1); // đảm bảo thêm node cha trước khi thêm node con
await editor.addNode(node1);
```

## Thứ tự node {#nodes-order}

Mặc định, plugin sẽ dùng thứ tự node riêng. Nếu bạn làm theo hướng dẫn [Basic](/docs/guides/basic), cần loại bỏ `AreaExtensions.simpleNodesOrder`

```ts
AreaExtensions.simpleNodesOrder(area);
```

Thứ tự node lồng nhau hơi khác, vì node cha không nên che node con. Khi đưa node lên trên hoặc thêm node con, thứ tự node con sẽ được điều chỉnh (qua sự kiện `reordered`).

## Sắp xếp node {#arrange-nodes}

Hướng dẫn [Arrange nodes](/docs/guides/arrange) cũng có thể dùng để tự động sắp xếp vị trí các node với nhau, vì plugin này cũng hỗ trợ node lồng nhau.

## Thay đổi quan hệ động

Sau khi đã thêm node vào editor, để thay đổi liên kết giữa các node, ngoài việc thay đổi `node.parent` bạn cần gọi phương thức update rõ ràng

```ts
// trước đó đã gán parent1.id
node1.parent = undefined;
await scopes.update(parent1.id);
```

## Thay đổi padding node cha {#change-padding}

Mặc định, tất cả node có cùng padding. Bạn có thể tìm các giá trị này trong [API documentation](/docs/api/rete-scopes-plugin#props). Padding có thể tùy chỉnh cho từng node bằng option `padding`.

```ts
const scopes = new ScopesPlugin<Schemes>({
  padding: (nodeId) => ({ top: 40, left: 20, right: 20, bottom: 20 }),
});
```

## Loại trừ node {#exclude-nodes}

Option `exclude` cho phép loại trừ các node nhất định khỏi việc xử lý của plugin. Điều này hữu ích khi bạn muốn một số node không ảnh hưởng đến kích thước node cha.

```ts
const scopes = new ScopesPlugin<Schemes>({
  exclude: (nodeId) => excludedNodes.includes(nodeId),
});
```

## Thay đổi kích thước node cha {#parent-size}

Kích thước sinh ra của node cha có thể tùy chỉnh cho từng node bằng option `size`. Tính năng này hữu ích khi node con đã bị xóa và bạn cần đặt lại kích thước để hiển thị layout đúng.

```ts
const scopes = new ScopesPlugin<Schemes>({
  size: (nodeId, size) => ({ width: size.width, height: 100 }),
});
```

Xem kết quả hoàn chỉnh tại ví dụ [Scopes](/examples/scopes).
